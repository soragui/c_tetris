# ç¬¬ 9 è¯¾ï¼šè°ƒè¯•æŠ€å·§ ğŸ›

## 9.1 æœ¬è¯¾ç›®æ ‡

å­¦ä¼š C è¯­è¨€ç¨‹åºçš„è°ƒè¯•æ–¹æ³•ï¼ŒæŒæ¡å¸¸è§é—®é¢˜æ’æŸ¥æŠ€å·§ã€‚

---

## 9.2 ç¼–è¯‘è­¦å‘Š

### å¼€å¯æ‰€æœ‰è­¦å‘Š

```makefile
# Makefile
CFLAGS = -Wall -Wextra -std=c99
```

**è­¦å‘Šé€‰é¡¹ï¼š**
| é€‰é¡¹ | å«ä¹‰ | ä½œç”¨ |
|------|------|------|
| `-Wall` | Warning All | æ˜¾ç¤ºæ‰€æœ‰è­¦å‘Š |
| `-Wextra` | Warning Extra | æ˜¾ç¤ºé¢å¤–è­¦å‘Š |
| `-Werror` | Warning Error | æŠŠè­¦å‘Šå½“é”™è¯¯ |

### å¸¸è§è­¦å‘ŠåŠè§£å†³

**è­¦å‘Š 1ï¼šæœªä½¿ç”¨å˜é‡**
```c
warning: unused variable 'x'

// è§£å†³ï¼šåˆ é™¤æˆ–ä½¿ç”¨è¯¥å˜é‡
int x = 5;  // âŒ
printf("%d", x);  // âœ…
```

**è­¦å‘Š 2ï¼šéšå¼å‡½æ•°å£°æ˜**
```c
warning: implicit declaration of function 'foo'

// è§£å†³ï¼šæ·»åŠ å‡½æ•°å£°æ˜æˆ–åŒ…å«å¤´æ–‡ä»¶
void foo(void);  // å£°æ˜
#include "foo.h" // æˆ–åŒ…å«å¤´æ–‡ä»¶
```

**è­¦å‘Š 3ï¼šç±»å‹ä¸åŒ¹é…**
```c
warning: comparison between signed and unsigned

// è§£å†³ï¼šç»Ÿä¸€ç±»å‹
int x = -1;
unsigned int y = 5;
if (x < y) ...  // âŒ è­¦å‘Š

int x = -1;
int y = 5;
if (x < y) ...  // âœ…
```

---

## 9.3 printf è°ƒè¯•æ³•

### åŸºç¡€ç”¨æ³•

```c
printf("DEBUG: x = %d\n", x);
printf("DEBUG: ä½ç½® (%d, %d)\n", game->current.x, game->current.y);
```

### è°ƒè¯•è¾“å‡ºæŠ€å·§

**1. æ ‡è®°ä»£ç æ‰§è¡Œä½ç½®**
```c
printf("=== è¿›å…¥ game_update() ===\n");
// ... ä»£ç 
printf("=== ç¦»å¼€ game_update() ===\n");
```

**2. æ‰“å°å…³é”®å˜é‡**
```c
printf("åˆ†æ•°ï¼š%d, ç­‰çº§ï¼š%d, è¡Œæ•°ï¼š%d\n", 
       game->score, game->level, game->lines_cleared);
```

**3. æ¡ä»¶æ‰“å°**
```c
if (game->game_over) {
    printf("æ¸¸æˆç»“æŸï¼æœ€ç»ˆåˆ†æ•°ï¼š%d\n", game->score);
}
```

**4. è°ƒè¯•ç¢°æ’æ£€æµ‹**
```c
bool check_collision(Tetromino* t, Board* board) {
    for (int i = 0; i < 4; i++) {
        for (int j = 0; j < 4; j++) {
            if (t->shape[i][j]) {
                int x = t->x + j;
                int y = t->y + i;
                printf("æ£€æŸ¥ (%d,%d) å½¢çŠ¶ [%d][%d]=%d\n", 
                       x, y, i, j, t->shape[i][j]);
            }
        }
    }
}
```

---

## 9.4 å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1ï¼šæ–¹å—æ˜¾ç¤ºä¹±ç 

**ç—‡çŠ¶ï¼š** æ–¹å—æ˜¾ç¤ºä¸º `` æˆ–å…¶ä»–ä¹±ç 

**åŸå› ï¼š** ä½¿ç”¨äº†ä¸­æ–‡å­—ç¬¦æˆ– Unicode

**è§£å†³ï¼š**
```c
// âŒ é”™è¯¯
mvaddstr(y, x, "â–ˆâ–ˆ");

// âœ… æ­£ç¡®
mvaddch(y, x * 2, ACS_CKBOARD);
mvaddch(y, x * 2 + 1, ACS_CKBOARD);
```

### é—®é¢˜ 2ï¼šæ–¹å—ä¸‹è½å¤ªå¿«

**ç—‡çŠ¶ï¼š** æ–¹å—ç¬é—´åˆ°åº•ï¼Œæ— æ³•æ§åˆ¶

**åŸå› ï¼š** drop_interval è®¾ç½®å¤ªå°

**è§£å†³ï¼š**
```c
// game_init() ä¸­
game->drop_interval = 3000;  // 3 ç§’/æ ¼
// ä¸æ˜¯ 100 æˆ– 500
```

### é—®é¢˜ 3ï¼šç¢°æ’æ£€æµ‹å¤±æ•ˆ

**ç—‡çŠ¶ï¼š** æ–¹å—ç©¿å¢™æˆ–ç©¿è¿‡å…¶ä»–æ–¹å—

**æ’æŸ¥æ­¥éª¤ï¼š**
```c
// 1. æ·»åŠ è°ƒè¯•è¾“å‡º
printf("æ–¹å—ä½ç½®ï¼š(%d, %d)\n", game->current.x, game->current.y);
printf("æ£‹ç›˜ [%d][%d] = %d\n", y, x, board->cells[y][x]);

// 2. æ£€æŸ¥åæ ‡è®¡ç®—
int x = t->x + j;  // ç¡®è®¤ t->x æ­£ç¡®
int y = t->y + i;  // ç¡®è®¤ t->y æ­£ç¡®

// 3. æ£€æŸ¥è¾¹ç•Œæ¡ä»¶
if (x < 0) printf("ç¢°æ’ï¼šå·¦è¾¹ç•Œ\n");
if (x >= BOARD_WIDTH) printf("ç¢°æ’ï¼šå³è¾¹ç•Œ\n");
```

### é—®é¢˜ 4ï¼šå†…å­˜æ³„æ¼

**æ£€æµ‹å·¥å…·ï¼švalgrind**
```bash
# å®‰è£…
sudo apt install valgrind

# è¿è¡Œ
valgrind --leak-check=full ./tetris

# è¾“å‡ºç¤ºä¾‹
==1234== 40 bytes in 1 blocks are definitely lost
==1234==    at 0x4C2FB55: malloc (in ...)
==1234==    by 0x400ABC: game_create (game.c:10)
```

**è§£å†³ï¼š** ç¡®ä¿æ¯ä¸ª malloc éƒ½æœ‰å¯¹åº”çš„ free
```c
Game* game = malloc(sizeof(Game));
// ... ä½¿ç”¨
free(game);  // åˆ«å¿˜äº†ï¼
```

---

## 9.5 è°ƒè¯•ç‰ˆæœ¬

### Makefile æ·»åŠ  debug ç›®æ ‡

```makefile
# è°ƒè¯•ç‰ˆæœ¬
debug: CFLAGS += -g -DDEBUG
debug: clean all

# å‘å¸ƒç‰ˆæœ¬
release: CFLAGS += -O2 -DNDEBUG
release: clean all
```

### æ¡ä»¶ç¼–è¯‘è°ƒè¯•ä»£ç 

```c
#ifdef DEBUG
    printf("DEBUG: è¯¦ç»†è¾“å‡º\n");
#endif

// ä½¿ç”¨
make debug   // ç¼–è¯‘è°ƒè¯•ç‰ˆæœ¬ï¼Œæœ‰è°ƒè¯•è¾“å‡º
make release // ç¼–è¯‘å‘å¸ƒç‰ˆæœ¬ï¼Œæ— è°ƒè¯•è¾“å‡º
```

---

## 9.6 åˆ†æ®µè°ƒè¯•æ³•

### éš”ç¦»é—®é¢˜

```c
// é—®é¢˜ï¼šæ¸¸æˆè¿è¡Œä¸æ­£å¸¸
// æ–¹æ³•ï¼šåˆ†æ®µæµ‹è¯•

// 1. æµ‹è¯•åˆå§‹åŒ–
game_init(game);
printf("åˆå§‹åŒ–å®Œæˆ\n");
getch();  // æš‚åœï¼Œæ£€æŸ¥çŠ¶æ€

// 2. æµ‹è¯•æ¸²æŸ“
game_render(game);
printf("æ¸²æŸ“å®Œæˆ\n");
getch();

// 3. æµ‹è¯•è¾“å…¥
int key = input_get_key();
printf("æŒ‰é”®ï¼š%d\n", key);
```

### æœ€å°åŒ–æµ‹è¯•

```c
// åˆ›å»ºæœ€å°æµ‹è¯•ç¨‹åº
#include "tetromino.h"

int main() {
    Tetromino t;
    tetromino_init(&t, TETRO_I);
    printf("æ–¹å—åˆå§‹åŒ–æˆåŠŸ\n");
    printf("ä½ç½®ï¼š(%d, %d)\n", t.x, t.y);
    return 0;
}

// ç¼–è¯‘æµ‹è¯•
gcc -Isrc src/tetromino.c test.c -o test
./test
```

---

## âœ… æœ¬è¯¾æ£€æŸ¥æ¸…å•

- [ ] ä¼šå¼€å¯ç¼–è¯‘è­¦å‘Š
- [ ] ä¼šç”¨ printf è°ƒè¯•
- [ ] çŸ¥é“å¸¸è§é—®é¢˜çš„è§£å†³æ–¹æ³•
- [ ] äº†è§£ valgrind å·¥å…·
- [ ] ä¼šåˆ›å»ºè°ƒè¯•ç‰ˆæœ¬

---

## ğŸ“ å°ä½œä¸š

1. åœ¨ç¢°æ’æ£€æµ‹å‡½æ•°ä¸­æ·»åŠ è°ƒè¯•è¾“å‡º

2. ä½¿ç”¨ valgrind æ£€æŸ¥æ˜¯å¦æœ‰å†…å­˜æ³„æ¼

3. åˆ›å»ºä¸€ä¸ªæœ€å°æµ‹è¯•ç¨‹åºï¼Œåªæµ‹è¯•æ–¹å—æ—‹è½¬åŠŸèƒ½

---

ä¸‹ä¸€è¯¾ï¼š[å½±å­æ–¹å—](10-å½±å­æ–¹å—.md)
