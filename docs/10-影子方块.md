# 第 10 课：影子方块 👻

## 10.1 什么是影子方块？

影子方块显示当前方块的最终落点，帮助玩家规划：

```
┌────────┐
│        │
│  ██    │  ← 当前方块
│  ██    │
│        │
│        │
│  ░░    │  ← 影子方块（预测落点）
│  ░░    │
└────────┘
```

## 10.2 实现原理

1. 复制当前方块到影子方块
2. 让影子方块一直下落
3. 直到碰撞前一刻停止
4. 绘制影子（半透明）

## 10.3 代码实现

```c
// game.h - 添加影子方块
typedef struct {
    Tetromino current;
    Tetromino ghost;  // 影子方块
    // ...
} Game;

// game.c - 计算影子位置
void game_calculate_ghost(Game* game) {
    game->ghost = game->current;
    
    while (1) {
        game->ghost.y++;
        if (board_check_collision(&game->board, &game->ghost)) {
            game->ghost.y--;  // 退回一格
            break;
        }
    }
}

// render.c - 渲染影子
void render_ghost(Tetromino* t) {
    attron(COLOR_PAIR(8));
    attron(A_DIM);  // 半透明效果
    
    for (int i = 0; i < 4; i++) {
        for (int j = 0; j < 4; j++) {
            if (t->shape[i][j]) {
                mvaddstr(y, x * 2, "░░");  // 使用浅色字符
            }
        }
    }
    
    attroff(A_DIM);
    attroff(COLOR_PAIR(8));
}
```

## 10.4 渲染顺序

```c
void render_game(Game* game) {
    clear();
    
    render_ghost(&game->ghost);      // 1. 最底层：影子
    render_board(&game->board);      // 2. 中间层：已固定方块
    render_tetromino(&game->current);// 3. 最上层：当前方块
    
    refresh();
}
```

## ✅ 本课检查清单

- [ ] 理解影子方块的作用
- [ ] 掌握影子位置计算
- [ ] 知道渲染顺序的重要性
- [ ] 会使用 A_DIM 实现半透明效果

---

下一课：[最高分系统](11-最高分系统.md)
