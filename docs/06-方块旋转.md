# 第 6 课：方块旋转 🔄

## 6.1 旋转原理

方块旋转本质是 4x4 矩阵的顺时针旋转 90 度：

```
旋转前：              旋转后：
0 1 0 0              0 0 1 0
1 1 1 0    →         0 1 1 0
0 0 0 0              0 0 1 0
0 0 0 0              0 0 0 0

T 方块                T 方块旋转 90 度
```

## 6.2 矩阵旋转公式

**顺时针旋转 90 度：**
```
新位置 [j][3-i] = 原位置 [i][j]
```

```c
// 示例：4x4 矩阵顺时针旋转
for (int i = 0; i < 4; i++) {
    for (int j = 0; j < 4; j++) {
        temp[j][3-i] = shape[i][j];
    }
}
```

## 6.3 代码实现

```c
// tetromino.c
void tetromino_rotate(Tetromino* t) {
    int temp[4][4];
    int old_shape[4][4];
    
    // 保存原形状
    memcpy(old_shape, t->shape, sizeof(t->shape));
    
    // 顺时针旋转 90 度
    for (int i = 0; i < 4; i++) {
        for (int j = 0; j < 4; j++) {
            temp[j][3-i] = t->shape[i][j];
        }
    }
    
    // 应用旋转
    memcpy(t->shape, temp, sizeof(t->shape));
    t->rotation = (t->rotation + 1) % 4;
}
```

## 6.4 墙踢（Wall Kick）

当方块在墙边旋转时，需要"踢"开墙壁：

```
墙边旋转前：          旋转后（墙踢）：
┌──────┐            ┌──────┐
│█     │            │  █   │
│███   │   →        │ ███  │
└──────┘            └──────┘
```

### 墙踢实现

```c
void tetromino_rotate(Tetromino* t, Board* board) {
    // 保存原状态
    Tetromino temp = *t;
    
    // 旋转
    // ... 旋转代码
    
    // 检查碰撞
    if (check_collision(&temp, board)) {
        // 尝试向左踢
        temp.x -= 1;
        if (check_collision(&temp, board)) {
            // 尝试向右踢
            temp.x += 2;
            if (check_collision(&temp, board)) {
                // 恢复原状
                *t = original;
                return;
            }
        }
    }
    
    // 应用旋转
    *t = temp;
}
```

## ✅ 本课检查清单

- [ ] 理解矩阵旋转原理
- [ ] 掌握旋转公式
- [ ] 知道什么是墙踢
- [ ] 会实现基本的旋转功能

---

下一课：[消行逻辑](08-消行逻辑.md)
