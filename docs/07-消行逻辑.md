# ç¬¬ 7 è¯¾ï¼šæ¶ˆè¡Œé€»è¾‘ ğŸ§¹

## 7.1 æ¶ˆè¡ŒåŸç†

å½“ä¸€è¡Œè¢«æ–¹å—å®Œå…¨å¡«æ»¡æ—¶ï¼Œéœ€è¦ï¼š
1. æ¶ˆé™¤è¯¥è¡Œ
2. ä¸Šé¢çš„æ‰€æœ‰è¡Œä¸‹è½ä¸€æ ¼
3. è®¡ç®—åˆ†æ•°

```
æ¶ˆé™¤å‰ï¼š              æ¶ˆé™¤åï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        â”‚          â”‚        â”‚
â”‚ â–ˆâ–ˆâ–ˆâ–ˆ   â”‚  â† æ»¡è¡Œ  â”‚        â”‚  â† ç©ºäº†
â”‚â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â”‚          â”‚ â–ˆâ–ˆâ–ˆâ–ˆ   â”‚  â† ä¸Šé¢çš„ä¸‹è½
â”‚â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚          â”‚â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 7.2 æ£€æµ‹æ»¡è¡Œ

```c
// board.c
int board_clear_lines(Board* board) {
    int cleared = 0;
    
    // ä»åº•éƒ¨å‘ä¸Šæ£€æŸ¥
    for (int y = BOARD_HEIGHT - 1; y >= 0; y--) {
        bool full = true;
        
        // æ£€æŸ¥è¯¥è¡Œæ˜¯å¦å…¨æ»¡
        for (int x = 0; x < BOARD_WIDTH; x++) {
            if (!board->cells[y][x]) {
                full = false;
                break;
            }
        }
        
        if (full) {
            cleared++;
            // æ¶ˆé™¤è¯¥è¡Œï¼ˆåœ¨ä¸‹æ–¹å¤„ç†ï¼‰
        }
    }
    
    return cleared;
}
```

## 7.3 æ¶ˆé™¤å¹¶ä¸‹è½

```c
if (full) {
    cleared++;
    
    // å°†ä¸Šé¢çš„æ‰€æœ‰è¡Œä¸‹ç§»ä¸€æ ¼
    for (int yy = y; yy > 0; yy--) {
        memcpy(board->cells[yy], 
               board->cells[yy-1], 
               sizeof(board->cells[0]));
    }
    
    // æ¸…ç©ºé¡¶è¡Œ
    memset(board->cells[0], 0, sizeof(board->cells[0]));
    
    // é‡æ–°æ£€æŸ¥å½“å‰è¡Œï¼ˆå› ä¸ºä¸Šé¢çš„è¡Œä¸‹è½äº†ï¼‰
    y++;
}
```

## 7.4 å®Œæ•´å®ç°

```c
int board_clear_lines(Board* board) {
    int cleared = 0;
    
    for (int y = BOARD_HEIGHT - 1; y >= 0; y--) {
        bool full = true;
        
        // æ£€æŸ¥è¯¥è¡Œæ˜¯å¦å…¨æ»¡
        for (int x = 0; x < BOARD_WIDTH; x++) {
            if (!board->cells[y][x]) {
                full = false;
                break;
            }
        }
        
        if (full) {
            cleared++;
            
            // ä¸‹ç§»ä¸Šé¢çš„è¡Œ
            for (int yy = y; yy > 0; yy--) {
                memcpy(board->cells[yy], 
                       board->cells[yy-1], 
                       sizeof(board->cells[0]));
            }
            
            // æ¸…ç©ºé¡¶è¡Œ
            memset(board->cells[0], 0, sizeof(board->cells[0]));
            
            // é‡æ–°æ£€æŸ¥å½“å‰è¡Œ
            y++;
        }
    }
    
    return cleared;
}
```

## 7.5 è®¡åˆ†è§„åˆ™

```c
// score.c
#define SCORE_SINGLE  40    // 1 è¡Œ
#define SCORE_DOUBLE  100   // 2 è¡Œ
#define SCORE_TRIPLE  300   // 3 è¡Œ
#define SCORE_TETRIS  1200  // 4 è¡Œï¼ˆä¿„ç½—æ–¯æ–¹å—ï¼ï¼‰

int score_calculate_lines(int lines, int level) {
    int base_scores[] = {0, 40, 100, 300, 1200};
    if (lines >= 1 && lines <= 4) {
        return base_scores[lines] * (level + 1);
    }
    return 0;
}
```

**ç¤ºä¾‹ï¼š**
- ç­‰çº§ 0 æ¶ˆé™¤ 1 è¡Œï¼š40 Ã— 1 = 40 åˆ†
- ç­‰çº§ 2 æ¶ˆé™¤ 4 è¡Œï¼š1200 Ã— 3 = 3600 åˆ†

## âœ… æœ¬è¯¾æ£€æŸ¥æ¸…å•

- [ ] ç†è§£æ¶ˆè¡ŒåŸç†
- [ ] ä¼šæ£€æµ‹æ»¡è¡Œ
- [ ] æŒæ¡è¡Œä¸‹è½çš„å®ç°
- [ ] çŸ¥é“è®¡åˆ†è§„åˆ™

---

ä¸‹ä¸€è¯¾ï¼š[UI ç•Œé¢](10-UI ç•Œé¢.md)
